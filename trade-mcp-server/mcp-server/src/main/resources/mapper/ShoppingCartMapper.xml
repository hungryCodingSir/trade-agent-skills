<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cbec.mcp.server.mapper.ShoppingCartMapper">

    <resultMap id="CartItemVOMap" type="com.cbec.mcp.server.dto.CartItemVO">
        <result column="cart_id"           property="cartId"/>
        <result column="product_id"        property="productId"/>
        <result column="product_name"      property="productName"/>
        <result column="product_name_en"   property="productNameEn"/>
        <result column="sku"               property="sku"/>
        <result column="unit_price"        property="unitPrice"/>
        <result column="currency"          property="currency"/>
        <result column="quantity"          property="quantity"/>
        <result column="subtotal"          property="subtotal"/>
        <result column="selected"          property="selected"/>
        <result column="stock_quantity"    property="stockQuantity"/>
        <result column="min_order_quantity" property="minOrderQuantity"/>
        <result column="origin_country"    property="originCountry"/>
        <result column="added_at"          property="addedAt"/>
    </resultMap>

    <select id="selectCartWithProduct" resultMap="CartItemVOMap">
        SELECT
            c.id          AS cart_id,
            c.product_id,
            p.name_zh     AS product_name,
            p.name_en     AS product_name_en,
            p.sku,
            p.price       AS unit_price,
            p.currency,
            c.quantity,
            (p.price * c.quantity) AS subtotal,
            c.selected,
            p.stock_quantity,
            p.min_order_quantity,
            p.origin_country,
            c.created_at  AS added_at
        FROM shopping_cart c
        INNER JOIN product p ON c.product_id = p.id
        WHERE c.user_id = #{userId}
        ORDER BY c.created_at DESC
    </select>

</mapper>
